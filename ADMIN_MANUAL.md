# Руководство администратора

## Школьное приложение

*Версия 1.0*

## Содержание

1. [Введение](#введение)
2. [Системные требования](#системные-требования)
3. [Установка](#установка)
   - [Установка веб-приложения](#установка-веб-приложения)
   - [Установка десктопного приложения](#установка-десктопного-приложения)
4. [Настройка системы](#настройка-системы)
   - [Конфигурация базы данных](#конфигурация-базы-данных)
   - [Настройки безопасности](#настройки-безопасности)
5. [Администрирование пользователей](#администрирование-пользователей)
   - [Создание новых пользователей](#создание-новых-пользователей)
   - [Управление ролями](#управление-ролями)
   - [Сброс паролей](#сброс-паролей)
6. [Управление учебными данными](#управление-учебными-данными)
   - [Группы и классы](#группы-и-классы)
   - [Предметы](#предметы)
   - [Расписание](#расписание)
7. [Резервное копирование и восстановление](#резервное-копирование-и-восстановление)
8. [Мониторинг и обслуживание](#мониторинг-и-обслуживание)
9. [Устранение неполадок](#устранение-неполадок)

## Введение

Это руководство предназначено для администраторов системы "Школьное приложение". Здесь вы найдете информацию о настройке, управлении и обслуживании системы. В руководстве описаны процедуры для установки как веб-версии, так и десктопной версии приложения, а также различные административные задачи.

Администраторы имеют полный доступ к системе и отвечают за:
- Настройку и обслуживание системы
- Управление пользователями и их правами
- Настройку учебного процесса (группы, предметы, расписание)
- Обеспечение безопасности и целостности данных

## Системные требования

### Минимальные требования для веб-сервера:
- Python 3.11 или выше
- 2 ГБ оперативной памяти
- 1 ГБ свободного места на диске
- Доступ к интернету для установки зависимостей

### Рекомендуемые требования для веб-сервера:
- Python 3.11 или выше
- 4 ГБ оперативной памяти
- 10 ГБ свободного места на диске
- SSD-накопитель
- Стабильное интернет-соединение

### Требования для клиентских устройств:
- Любой современный браузер (Chrome, Firefox, Edge, Safari)
- 1 ГБ оперативной памяти
- Стабильное интернет-соединение

### Требования для десктопного приложения:
- Windows 10/11, macOS 10.14+ или Linux с графическим интерфейсом
- 2 ГБ оперативной памяти
- 2 ГБ свободного места на диске

## Установка

### Установка веб-приложения

1. Убедитесь, что Python 3.11 или выше установлен в системе. Проверить версию можно с помощью команды:
   ```powershell
   python --version
   ```

2. Клонируйте репозиторий из системы контроля версий или распакуйте архив с приложением в нужную директорию:
   ```powershell
   git clone [URL репозитория] school_app
   cd school_app
   ```

3. Рекомендуется создать виртуальное окружение Python:
   ```powershell
   python -m venv venv
   .\venv\Scripts\Activate
   ```

4. Установите все необходимые зависимости:
   ```powershell
   pip install -r requirements.txt
   ```

5. Инициализируйте базу данных:
   ```powershell
   python init_db.py
   ```

6. Запустите приложение:
   ```powershell
   python run.py
   ```

7. По умолчанию приложение будет доступно по адресу: http://localhost:5000

### Установка десктопного приложения

1. Выполните шаги 1-5 из предыдущего раздела.

2. Запустите десктопное приложение:
   ```powershell
   python app_desktop.py
   ```

3. Для создания исполняемого файла используйте PyInstaller (должен быть установлен через pip):
   ```powershell
   pyinstaller school_desktop_app.spec
   ```

4. После завершения сборки, исполняемый файл будет доступен в директории `dist`.

## Настройка системы

### Конфигурация базы данных

Приложение использует SQLite по умолчанию для хранения данных. Конфигурация базы данных задается в файле `config.py`:

```python
SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or 'sqlite:///app.db'
```

Для использования другой СУБД (например, PostgreSQL или MySQL):

1. Установите необходимые драйверы:
   ```powershell
   pip install psycopg2-binary  # для PostgreSQL
   # или
   pip install pymysql  # для MySQL
   ```

2. Измените строку подключения в файле `config.py` или установите переменную среды `DATABASE_URL`:
   - Для PostgreSQL:
     ```
     postgresql://username:password@localhost/dbname
     ```
   - Для MySQL:
     ```
     mysql+pymysql://username:password@localhost/dbname
     ```

3. Перед запуском приложения с новой базой данных, повторно инициализируйте базу:
   ```powershell
   python init_db.py
   ```

### Настройки безопасности

В файле `config.py` вы можете настроить параметры безопасности приложения:

1. **SECRET_KEY** - секретный ключ для сессий и CSRF-токенов. В продакшн-среде рекомендуется установить через переменную окружения:
   ```powershell
   $env:SECRET_KEY = "ваш-секретный-ключ"
   ```

2. **SESSION_COOKIE_SECURE** - установите `True` для передачи cookie только через HTTPS:
   ```python
   SESSION_COOKIE_SECURE = True
   ```

3. **PERMANENT_SESSION_LIFETIME** - время жизни сессии в секундах:
   ```python
   PERMANENT_SESSION_LIFETIME = 3600  # 1 час
   ```

4. **WTF_CSRF_ENABLED** - защита от CSRF-атак (рекомендуется оставить включенной):
   ```python
   WTF_CSRF_ENABLED = True
   ```

## Администрирование пользователей

### Создание новых пользователей

1. Войдите в систему с правами администратора.
2. Перейдите в раздел "Пользователи" в панели администратора.
3. Нажмите кнопку "Добавить пользователя".
4. Заполните форму с информацией о новом пользователе:
   - Email (используется как имя пользователя)
   - Имя
   - Фамилия
   - Пароль
   - Роль (студент, преподаватель, администратор)
5. Нажмите "Сохранить".

Для массового импорта пользователей:
1. Подготовьте CSV-файл со следующими столбцами:
   - email
   - first_name
   - last_name
   - role
   - password (опционально)
2. В разделе "Пользователи" нажмите "Импорт" и загрузите файл.
3. При необходимости укажите параметры импорта и подтвердите операцию.

### Управление ролями

В системе предусмотрены следующие роли:
- **admin** - полный доступ к системе
- **teacher** - доступ к управлению оценками, посещаемостью и просмотру учебных материалов
- **student** - доступ к просмотру своих оценок, расписания и посещаемости

Для изменения роли пользователя:
1. Найдите пользователя в списке.
2. Нажмите на иконку редактирования.
3. Измените роль в выпадающем списке.
4. Нажмите "Сохранить".

### Сброс паролей

1. Найдите пользователя в списке.
2. Нажмите на кнопку "Сбросить пароль".
3. Система предложит два варианта:
   - Автоматически сгенерировать новый пароль
   - Установить конкретный пароль
4. Выберите нужный вариант и подтвердите действие.
5. Новый пароль будет показан на экране (только один раз). Сообщите этот пароль пользователю.

## Управление учебными данными

### Группы и классы

Для создания новой группы:
1. Перейдите в раздел "Группы".
2. Нажмите кнопку "Добавить группу".
3. Заполните форму:
   - Название группы
   - Факультет или отделение
   - Год обучения
4. Нажмите "Сохранить".

Для добавления студентов в группу:
1. Выберите нужную группу из списка.
2. Нажмите "Управление студентами".
3. Используйте элементы управления для добавления или удаления студентов.
4. Нажмите "Сохранить" после внесения изменений.

### Предметы

Для создания нового предмета:
1. Перейдите в раздел "Предметы".
2. Нажмите кнопку "Добавить предмет".
3. Заполните форму:
   - Название предмета
   - Описание
   - Преподаватель (выберите из списка)
4. Нажмите "Сохранить".

Для назначения преподавателя на предмет:
1. Найдите нужный предмет в списке.
2. Нажмите на иконку редактирования.
3. Выберите преподавателя из выпадающего списка.
4. Нажмите "Сохранить".

### Расписание

Для создания расписания:
1. Перейдите в раздел "Расписание".
2. Нажмите кнопку "Добавить занятие".
3. Заполните форму:
   - Группа
   - Предмет
   - День недели
   - Время начала и окончания
   - Аудитория
4. Нажмите "Сохранить".

Для массового импорта расписания:
1. Подготовьте CSV-файл со всеми необходимыми данными.
2. В разделе "Расписание" нажмите "Импорт" и загрузите файл.
3. Выполните сопоставление столбцов и подтвердите импорт.

## Резервное копирование и восстановление

### Создание резервной копии базы данных

Для SQLite:
1. Остановите приложение, если оно запущено.
2. Скопируйте файл базы данных `instance/app.db` в безопасное место:
   ```powershell
   Copy-Item "instance\app.db" "backups\app.db.$(Get-Date -Format 'yyyyMMdd_HHmmss')"
   ```

Для PostgreSQL:
```powershell
pg_dump -U username -d dbname -F c -f backup_file.dump
```

Для MySQL:
```powershell
mysqldump -u username -p dbname > backup_file.sql
```

### Восстановление из резервной копии

Для SQLite:
1. Остановите приложение, если оно запущено.
2. Замените файл базы данных резервной копией:
   ```powershell
   Copy-Item "backups\app.db.20240515_120000" "instance\app.db"
   ```

Для PostgreSQL:
```powershell
pg_restore -U username -d dbname -c backup_file.dump
```

Для MySQL:
```powershell
mysql -u username -p dbname < backup_file.sql
```

### Рекомендации по расписанию резервного копирования

- Ежедневное резервное копирование в рабочие дни
- Еженедельное полное резервное копирование
- Сохранение копий за последний месяц
- Хранение копий в нескольких местах (локальное хранилище + облачное хранилище)

## Мониторинг и обслуживание

### Журналы приложения

По умолчанию приложение ведет журнал в стандартный вывод. Для сохранения журналов в файл, запустите приложение с перенаправлением:

```powershell
python run.py > app_log.txt 2>&1
```

### Очистка устаревших данных

Система не имеет автоматической очистки данных. Для ручной очистки:

1. Создайте резервную копию перед очисткой.
2. Определите критерии устаревших данных (например, информация о выпускниках).
3. Используйте админ-панель или доступ к базе данных для удаления.

### Проверка целостности базы данных

Для SQLite:
```powershell
sqlite3 instance\app.db "PRAGMA integrity_check;"
```

## Устранение неполадок

### Проблема: Приложение не запускается

**Решение:**
1. Проверьте журналы ошибок на наличие подробной информации.
2. Убедитесь, что все зависимости установлены:
   ```powershell
   pip install -r requirements.txt
   ```
3. Проверьте доступ к базе данных.
4. Проверьте наличие всех необходимых файлов конфигурации.

### Проблема: Ошибка доступа к базе данных

**Решение:**
1. Проверьте правильность строки подключения в `config.py`.
2. Проверьте права доступа к файлу базы данных (для SQLite).
3. Проверьте, что сервер базы данных запущен (для PostgreSQL/MySQL).
4. Проверьте, что учетные данные для подключения к БД верны.

### Проблема: CSRF ошибки при отправке форм

**Решение:**
1. Убедитесь, что для всех форм включен CSRF-токен.
2. Проверьте, что `SECRET_KEY` настроен правильно и не меняется при каждом запуске.
3. Проверьте, что нет проблем с сессиями и куками.

### Проблема: Пользователи не могут войти в систему

**Решение:**
1. Проверьте, что учетные записи существуют в базе данных.
2. Убедитесь, что пароли хранятся и проверяются правильно.
3. Проверьте настройки сессий и аутентификации.
4. Сбросьте пароли пользователей, испытывающих проблемы.

---

Если у вас возникли вопросы или проблемы, которые не описаны в данном руководстве, обратитесь в службу технической поддержки по адресу: admin-support@school-app.ru
